{% extends 'home/base.html' %}
{% load hosts %}
{% load static %}

{% block head %}
<title>Documentation | The Clone Wars API</title>
<link rel="stylesheet" type="text/css" href="{% static 'documentation/css/documentation.css' %}" />
<script src="https://unpkg.com/vue-router/dist/vue-router.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.min.js"
    integrity="sha512-quHCp3WbBNkwLfYUMd+KwBAgpVukJu5MncuQaWXgCrfgcxCJAq/fo+oqrRKOj+UKEmyMCG3tb8RB63W+EmrOBg=="
    crossorigin="anonymous"></script>
{% endblock %}


{% block content %}
<div id="docs-app" class="w-full md:block lg:grid grid-cols-5 gap-4 px-2 md:px-0 md:mx-4 lg:mx-8 xl:mx-20">
    <div class="lg:col-span-1">
        {% include "documentation/sidenav.html" %}
    </div>
    <div id="docs-content" class="lg:col-span-4 bg-green-100 px-2 pb-1">
        <keep-alive>
            <router-view></router-view>
        </keep-alive>
    </div>
</div>
{% endblock %}


{% block js %}
<!-- <script src="https://cdn.jsdelivr.net/npm/vue-router/dist/vue-router.min.js"></script> -->
<script src="https://cdn.jsdelivr.net/npm/vue-router/dist/vue-router.js"></script>
<script defer>
    const GettingStarted = { template: `{% include "documentation/getting_started/getting_started.html" %}` };

    const Resources = { 
        template: `{% include "documentation/resources/resources.html" %}`,
        data() {
            return {
                showVehiclesClass: false,
                showVehiclesManufacturer: false,
            }
        },
        methods: {
            toggleShowVehiclesClass: function () {
                this.showVehiclesClass = !this.showVehiclesClass;
            },
            toggleShowVehiclesManufacturer: function () {
                this.showVehiclesManufacturer = !this.showVehiclesManufacturer;
            },
        },
    };

    const TryItOut = { 
        template: `{% include "documentation/try_it_out/try_it_out.html" %}`,
        data() {
            return {
                currentResource: 'characters',
                resourceId: 12,
                idData: null,
                randomData: null,
            }
        },
        mounted() {
            
        },
        methods: {
            getById: function() {
                axios.get(this.generateGetUrl(this.resourceId))
                    .then(result => this.idData = JSON.stringify(result.data, undefined, 2))
                    .catch(error => this.idData = JSON.stringify(error.response.data, undefined, 2));
            },
            getRandom: function() {
                axios.get(this.generateGetUrl('random'))
                    .then(result => this.randomData = JSON.stringify(result.data, undefined, 2));
            },
            generateGetUrl: function(val) {
                let url = 'http://api.clonewarsapi.com/';
                url += this.currentResource + '/' + val;
                console.log(url)
                return url;
            },
            setCurrentResource: function(val) {
                this.currentResource = val;
            }
        },
    };

    const router = new VueRouter({
        mode: 'history',
        scrollBehavior: function(to, from, savedPosition) {
            if (to.hash) {
                return {selector: to.hash}
            } else {
                return { x: 0, y: 0 }
            }
        },
        routes: [
            { path: '/', component: GettingStarted, name: 'Getting Started' },
            { path: '/resources', component: Resources, name: 'Resources' },
            { path: '/try-it-out', component: TryItOut, name: 'Try It Out' }
        ]
    });

    var docs_app = new Vue({
        router,
        el: '#docs-app',
        delimiters: ['[[', ']]'],
        data() {
            return {
                highlight: false,
                currentLink: 'Documentation',
                showNav: true,
                windowSizeChanged: false,
                loadedVehilcesApp: false,
            }
        },
        mounted() {
            this.updateNavHeader();
            this.resizeEventHandler();
        },
        created() {
            window.addEventListener("resize", this.resizeEventHandler);
            this.highlighLink();
        },
        destroyed() {
            window.removeEventListener("resize", this.resizeEventHandler);
        },
        watch: {
            $route (to, from){
                this.highlighLink();
            }
        },
        methods: {
            updateNavHeader: function() {
                this.currentLink = this.$route.name;
            },
            resizeEventHandler: function(e) {
                if (this.showNav && window.innerWidth < 1024) {
                    this.showNav = false;
                }
                else if (!this.showNav && window.innerWidth > 1023){
                    this.showNav = true;
                }
            },
            toggleNav: function() {
                this.showNav = !this.showNav;
            },
            highlighLink: function() {
                if (this.$route.fullPath.includes('/#')) {
                    this.highlight = true;
                }
                else {
                    this.highlight = false;
                }
                this.updateNavHeader();
            },
        },
    })
</script>
{% endblock %}